(()=>{"use strict";class t{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!Number.isInteger(t)||t<0)throw Error("Length must be a non-negative integer.");this.numHits=0,this.length=t}hit(){this.numHits+=1}isSunk(){return this.numHits>=this.length}}const e=(t,e)=>t.map(((t,n)=>t+e[n])),n=(t,e)=>t.map(((t,n)=>t*e[n])),r=(t,e)=>t.map(((t,n)=>t-e[n])),o={directionToArray:{left:[-1,0],right:[1,0],up:[0,1],down:[0,-1]},areCoordsEqual:(t,e)=>t.length===e.length&&t.every(((t,n)=>t===e[n])),doesListIncludeCoord(t,e){return t.some((t=>this.areCoordsEqual(t,e)))},areCoordsWithinRange:(t,e,n)=>t.every((t=>t>=e&&t<=n)),get2DBoard(t,e){const n=[];for(let r=0;r<t;r+=1){n.push([]);for(let o=0;o<t;o+=1)n[r].push(e(r,o))}return n},getBoxCoordinates(t,r,o,i){const s=[];for(let h=0;h<i;h+=1){const i=e([t,r],n(this.directionToArray[o],[h,h]));s.push(i)}return s},get4Neighbors(t,n,r){const o=Object.keys(this.directionToArray).sort((()=>Math.random()-.5)),i=[];return o.forEach((o=>{const s=e([t,n],this.directionToArray[o]);this.areCoordsWithinRange(s,0,r-1)&&i.push(s)})),i},getOrthogonalNeighbors(t,n){const o=this.directionToArray[n].map((t=>Math.abs(t))).map((t=>!t)),i=[];return i.push(e(t,o)),i.push(r(t,o)),i},getSurroundingValues(t,o,i,s,h){const{areCoordsWithinRange:a}=this,u={list:[],save(t){a(t,0,h-1)&&this.list.push(t)}},p=this.directionToArray[s];u.save(r([t,o],p)),u.save(e([t,o],n(p,[i,i])));const l=r([t,o],p);return this.getBoxCoordinates(l[0],l[1],s,i+2).forEach((t=>this.getOrthogonalNeighbors(t,s).forEach((t=>{u.save(t)})))),u.list}};class i{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;this.dim=t,this.board=i.buildBoard(this.dim),this.ships=[]}areAllShipsDown(){for(let t=0;t<this.ships.length;t+=1)if(!this.ships[t].ship.isSunk())return!1;return!0}isShipDown(t,e){return this.board[t][e].ship?this.board[t][e].ship.isSunk():null}isShipHitAtCoord(t,e){return this.board[t][e].ship&&this.board[t][e].attacked}isAttacked(t,e){return this.board[t][e].attacked}receiveAttack(t,e){if(!this.board[t][e].attacked&&(this.board[t][e].attacked=!0,this.board[t][e].ship&&this.board[t][e].ship.hit(),this.isShipDown(t,e))){const n=this.ships.find((n=>n.ship===this.board[t][e].ship)),r=o.getSurroundingValues(n.x,n.y,n.length,n.dir,this.dim);console.log(r),r.forEach((t=>{this.board[t[0]][t[1]].attacked=!0}))}}static getInsiderKey(){return{unhitEmpty:1,hitEmpty:2,unhitShip:3,hitShip:4}}getInsiderKnowledge(){const t=i.getInsiderKey();return this.iterator((e=>e.ship?e.attacked?t.hitShip:t.unhitShip:e.attacked?t.hitEmpty:t.unhitEmpty))}static getOutsiderKey(){return{unknown:1,noShip:2,hitShip:3,sunkShip:4}}getOutsiderKnowledge(){const t=i.getOutsiderKey();return this.iterator((e=>e.attacked?e.ship?e.ship.isSunk()?t.sunkShip:t.hitShip:t.noShip:t.unknown))}placeShip(e,n,r,i){const s=o.getBoxCoordinates(e,n,i,r);s.forEach((t=>{if(!o.areCoordsWithinRange(t,0,this.dim-1))throw Error("Ship is out of board range");if(this.board[t[0]][t[1]].ship)throw Error("Ship overlaps with existing ship")}));const h=new t(r);this.ships.push({ship:h,x:e,y:n,length:r,dir:i}),s.forEach((t=>{this.board[t[0]][t[1]].ship=h}))}iterator(t){return this.board.map((e=>e.map(t)))}static buildBoard(t){return o.get2DBoard(t,(()=>({attacked:!1})))}}function s(t,r){const i=[...r].sort(),s=o.get2DBoard(t,(()=>!1)),h=[];for(;i.length;){const r=["up","right"],a=r[Math.floor(Math.random()*r.length)],u=o.directionToArray[a],p=i[i.length-1],l=t-p;if(l<0)throw Error(`Ship of size ${p} is too large to fit into board with dimension ${t}`);const c=Math.floor(Math.random()*t),d=Math.floor(Math.random()*(l+1));let g;g="up"===a?[c,d]:[d,c];const f=[];for(let t=0;t<p;t+=1){const r=e(g,n(u,[t,t]));s[r[0]][r[1]]||f.push(r)}f.length===p&&(h.push({x:g[0],y:g[1],dir:a,length:p}),i.pop(),[...o.getSurroundingValues(g[0],g[1],p,a,t),...f].forEach((t=>{s[t[0]][t[1]]=!0})))}return h}const h=function(){let t=null,n=null,i=null;return{getMove:function(s,h){const a=s.length;function u(){return i&&s[i[0]][i[1]]===h.hitShip}t&&s[t[0]][t[1]]===h.hitShip&&u()?r(i,t).find((t=>0!==t))>0?n=i:t=i:u()&&(t=i,n=i);let p=function(){if(!t)return;const i=r(n,t).map((t=>0===t?0:1));if(o.areCoordsEqual(i,[0,0]))return o.get4Neighbors(t[0],t[1],a).find((t=>s[t[0]][t[1]]===h.unknown));const u=[e(n,i),r(t,i)];u.sort((()=>Math.random-.5));for(let t=0;t<u.length;t+=1){const e=u[t];if(o.areCoordsWithinRange(e,0,a-1)&&s[e[0]][e[1]]===h.unknown)return e}}();return p||(p=function(){const t=[];s.forEach(((e,n)=>e.forEach(((e,r)=>{e===h.unknown&&t.push([n,r])}))));const e=Math.floor(Math.random()*t.length);return t[e]}(),t=null,n=null),i=p,p},getShipPlacements:function(t,e){return s(t,e)}}}(),a={player:document.querySelector("div.player-board"),opponent:document.querySelector("div.opponent-board"),playerTurn:document.querySelector(".player-container .turn"),opponentTurn:document.querySelector(".opponent-container .turn")},u=function(){function t(t,e,n,r){function o(t,e){return Object.keys(t).find((n=>t[n]===e))}r.textContent="";const i=t.length;for(let s=i-1;s>=0;s-=1)for(let h=0;h<i;h+=1){const i=document.createElement("div");i.dataset.x=h,i.dataset.y=s,i.classList.add(n[o(e,t[h][s])],"cell"),r.appendChild(i)}}return{refreshView:function(e){t(e.opponentBoard,e.opponentBoardKey,{unknown:"empty",noShip:"hit",hitShip:"hit-ship",sunkShip:"sunk-ship"},a.opponent),t(e.playerBoard,e.playerBoardKey,{unhitEmpty:"empty",hitEmpty:"hit",unhitShip:"unhit-ship",hitShip:"sunk-ship"},a.player),e.switchTurn&&(a.turn,a.playerTurn.classList.toggle("active"),a.opponentTurn.classList.toggle("active"))}}}(),p=function(){const t=function(){const t=[5,4,4,3,3,2,2,1],e={player:new i(10),opponent:new i(10)};return Object.keys(e).forEach((n=>{let r;r="player"===n?s(10,t):h.getShipPlacements(10,t),r.forEach((t=>{e[n].placeShip(t.x,t.y,t.length,t.dir)}))})),e}();let e=null;function n(e){u.refreshView({playerBoard:t.player.getInsiderKnowledge(),playerBoardKey:i.getInsiderKey(),opponentBoard:t.opponent.getOutsiderKnowledge(),opponentBoardKey:i.getOutsiderKey(),switchTurn:e})}let r=!0;return n(!1),{playerMoves:function(o,s){var a,u;r&&null===e&&(a=o,u=s,!t.opponent.isAttacked(a,u)&&(t.opponent.receiveAttack(a,u),t.opponent.areAllShipsDown()&&(e=!0),1)&&(r=!1,n(!0),null===e&&(function(){const[n,r]=h.getMove(t.player.getOutsiderKnowledge(),i.getOutsiderKey());t.player.receiveAttack(n,r),t.player.areAllShipsDown()&&(e=!1)}(),setTimeout((()=>n(!1)),100),setTimeout((()=>{n(!0),r=!0}),200))))}}}();a.opponent.addEventListener("click",(t=>{if(!t.target.classList.contains("cell"))return;const{x:e,y:n}=t.target.dataset;p.playerMoves(e,n)}))})();